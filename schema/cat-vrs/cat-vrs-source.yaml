$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://w3id.org/ga4gh/schema/cat-vrs/1.x/cat-vrs-source.yaml"
title: GA4GH-Cat-VRS-Definitions
type: object
strict: true

imports:
  gks-core: ../gks-core/gks-core-source.yaml
  vrs: ../vrs/vrs-source.yaml

$defs:

  # =============================================================================
  # Top-level Categorical Variant concept
  # =============================================================================

  CategoricalVariant:
    type: object
    inherits: gks-core:Entity
    maturity: trial use
    description: >-
      A representation of a categorically-defined domain for variation, in which individual
      Constraintual variation instances may be members of the domain.
    properties:
      type:
        extends: type
        const: CategoricalVariant
        default: CategoricalVariant
        description: 'MUST be "CategoricalVariant"'
      members:
        type: array
        ordered: false
        description: >-
          A non-exhaustive list of VRS variation Constraints that satisfy the constraints of
          this categorical variant.
        items:
          oneOf:
            - $ref: /ga4gh/schema/vrs/2.x/json/Variation
            - $ref: /ga4gh/schema/gks-core/1.x/gks-core/json/iriReference
      constraints:
        type: array
        ordered: false
        items:
          $ref: "#/$defs/Constraint"
      mappings:
        type: array
        ordered: false
        items:
          $ref: "/ga4gh/schema/gks-core/1.x/json/ConceptMapping"
        description: >-
          A list of mappings to concepts in terminologies or code systems. Each mapping should
          include a coding and a relation.

  # =============================================================================
  # Constraint Definitions
  # =============================================================================

  Constraint:
    maturity: trial use
    description: >-
      Constraints are used to construct an intensional semantics of categorical variant types.
    oneOf:
      - $ref: "#/$defs/DefiningAlleleConstraint"
      - $ref: "#/$defs/DefiningLocationConstraint"
      - $ref: "#/$defs/CopyCountConstraint"
      - $ref: "#/$defs/CopyChangeConstraint"
      - $ref: "#/$defs/GeneContextConstraint"
      - $ref: "#/$defs/FunctionConstraint"
    heritableProperties:
      type:
        type: string
    heritableRequired:
      - type

  DefiningAlleleConstraint:
    maturity: trial use
    type: object
    inherits: Constraint
    description: >-
      The defining allele and its associated relationships that are congruent
      with member variants.
    properties:
      type:
        extends: type
        const: DefiningAlleleConstraint
        default: DefiningAlleleConstraint
        description: 'MUST be "DefiningAlleleConstraint"'
      allele:
        oneOf:
          - $ref: /ga4gh/schema/vrs/2.x/json/Allele
          - $ref: /ga4gh/schema/gks-core/1.x/json/iriReference
      relations:
        type: array
        ordered: false
        items:
          type: string
          enum:
            - translates_from
            - translates_from_reading_frame
            - liftover_to
            - transcribes_to
            - translates_to
            - translates_through
        description: >-
          Defined relationships from which members relate to the defining allele.
          ``sequence_liftover`` refers to variants or locations that represent a congruent concept on a differing assembly of a
          human genome (e.g. "GRCh37" and "GRCh38") or gene (e.g. Locus Reference Genomic) sequence. ``transcript_projection``
          refers to variants or locations that occur on transcripts projected from the defined genomic concept. ``codon_translation``
          refers to variants or locations that translate from the codon(s) represented by the defined concept.
    required:
      - allele

  DefiningLocationConstraint:
    maturity: trial use
    type: object
    inherits: Constraint
    description: >-
      The defining location and its associated relationships that are congruent
      with member locations.
    properties:
      type:
        extends: type
        const: DefiningLocationConstraint
        default: DefiningLocationConstraint
        description: 'MUST be "DefiningLocationConstraint"'
      location:
        oneOf:
          - $ref: /ga4gh/schema/vrs/2.x/json/SequenceLocation
          - $ref: /ga4gh/schema/gks-core/1.x/json/iriReference
      relations:
        type: array
        ordered: false
        items:
          type: string
          enum:
            - translates_from
            - translates_from_reading_frame
            - liftover_to
            - transcribes_to
            - translates_to
            - translates_through
        description: >-
          Defined relationships from which members relate to the defining location.
          ``sequence_liftover`` refers to variants or locations that represent a congruent concept on a differing assembly of a
          human genome (e.g. "GRCh37" and "GRCh38") or gene (e.g. Locus Reference Genomic) sequence. ``transcript_projection``
          refers to variants or locations that occur on transcripts projected from the defined genomic concept. ``codon_translation``
          refers to variants or locations that translate from the codon(s) represented by the defined concept.
      matchCharacteristic:
        type: string
        description: >-
          A characteristic of the location that is used to match the defining location to member locations.
        enum:
          - exact
          - encompass
          - within
          - overlap
    required:
      - location
      - matchCharacteristic

  GeneContextConstraint:
    maturity: draft
    type: object
    inherits: Constraint
    description: >-
      The functional unit of inheritance that members of this categorical variant are associated with.
    properties:
      type:
        extends: type
        const: GeneContextConstraint
        default: GeneContextConstraint
        description: 'MUST be "GeneContextConstraint"'
      geneContext:
        description: A gene identifier.
        type: string
      description:
        description: A free-text description of the gene context.
        type: string
      relations:
        type: array
        ordered: false
        items:
          type: string
          enum:
            - translates_from
            - translates_from_reading_frame
            - liftover_to
            - transcribes_to
            - translates_to
            - translates_through
        description: >-
          TBD
    required:
      - geneContext


  CopyCountConstraint:
    maturity: trial use
    inherits: Constraint
    type: object
    description:
      The exact or range of copies that members of this categorical
      variant must satisfy.
    properties:
      type:
        extends: type
        const: CopyCountConstraint
        default: CopyCountConstraint
        description: 'MUST be "CopyCountConstraint"'
      copies:
        description: >-
          The precise value or range of copies members of this categorical
          variant must satisfy.
        oneOf:
        - type: integer
        - $ref: /ga4gh/schema/vrs/2.x/json/Range
    required:
      - copies

  CopyChangeConstraint:
    maturity: draft
    inherits: Constraint
    type: object
    description: >-
      The relative assessment of the change in copies that members of
      this categorical variant satisfies.
    properties:
      type:
        extends: type
        const: CopyChangeConstraint
        default: CopyChangeConstraint
        description: 'MUST be "CopyChangeConstraint"'
      copyChange:
        description: >-
          The relative assessment of the change in copies that members of
          this categorical variant satisfies.
        type: string
        enum:
          - EFO:0030069
          - EFO:0020073
          - EFO:0030068
          - EFO:0030067
          - EFO:0030064
          - EFO:0030070
          - EFO:0030071
          - EFO:0030072
    required:
      - copyChange

  FunctionConstraint:
    maturity: draft
    inherits: Constraint
    type: object
    description: >-
        A relative assessment in the change of protein function that members of this categorical variant satisfies.
    properties:
      type:
        extends: type
        const: FunctionConstraint
        default: FunctionConstraint
        description: 'MUST be "FunctionConstraint"'
      functionConsequence:
        description: >-
          A categorical label of the function change that members of this categorical variant satisfies, using ontology terms from [The Sequence Ontology](http://www.sequenceontology.org). ``SO:0002052`` refers to a [dominant negative variant](http://www.sequenceontology.org/browser/current_release/term/SO:0002052), a variant where the mutated gene product adversely affects the other (wild type) gene product. ``SO:0002054`` refers to a [loss of function variant](http://www.sequenceontology.org/browser/current_release/term/SO:0002054), a sequence variant whereby the gene product has diminished or abolished function. ``SO:0001561`` refers to a [polypeptide partial loss of function](http://www.sequenceontology.org/browser/current_release/term/SO:0001561), a sequence variant that causes some but not all loss of polypeptide function with respect to a reference sequence. ``SO:0002219`` refers to a [functionally normal](http://www.sequenceontology.org/browser/current_release/term/SO:0002219) variant, a sequence variant in which the function of a gene product is retained with respect to a reference. ``SO:0001557`` refers to a [polypeptide gain of function variant](http://www.sequenceontology.org/browser/current_release/term/SO:0001557), a sequence variant which causes gain of polypeptide function with respect to a reference sequence. ``SO:0002053`` refers to a [gain of function variant](http://www.sequenceontology.org/browser/current_release/term/SO:0002053), a sequence variant whereby new or enhanced function is conferred on the gene product.
        type: string
        enum:
          - SO:0002052
          - SO:0002054
          - SO:0001561
          - SO:0002219
          - SO:0001557
          - SO:0002053
      description:
        description: >-
          A free-text description of the function change.
        type: string
    required:
      - functionConsequence